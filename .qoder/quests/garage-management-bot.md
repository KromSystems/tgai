# –î–∏–∑–∞–π–Ω —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–∞—Ä–∞–∂–æ–º –¥–ª—è Telegram –±–æ—Ç–∞

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–∞—Ä–∞–∂–æ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –º–æ–¥—É–ª—å –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ Telegram –±–æ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–º–µ–Ω–æ–π –º–∞—Å–ª–∞ –≤ –∞–≤—Ç–æ–º–æ–±–∏–ª—è—Ö —Å–µ–º—å–∏ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É –∑–∞—è–≤–æ–∫ —Å –º–æ–¥–µ—Ä–∞—Ü–∏–µ–π –∏ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è–º–∏.

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–ª–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —É—á–µ—Ç–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –≤ –≥–∞—Ä–∞–∂–µ
- –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–æ–∫ –Ω–∞ –∑–∞–º–µ–Ω—É –º–∞—Å–ª–∞ —á–µ—Ä–µ–∑ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
- –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∑–∞—è–≤–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã–ø–ª–∞—Ç—ã –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–π (3 –º–ª–Ω –∏–≥—Ä–æ–≤–æ–π –≤–∞–ª—é—Ç—ã)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

```mermaid
graph TB
    subgraph "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å"
        A["/garage –∫–æ–º–∞–Ω–¥–∞"] --> B[–°–ø–∏—Å–æ–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π]
        B --> C[–ü–∞–≥–∏–Ω–∞—Ü–∏—è –ø–æ 5 –∞–≤—Ç–æ]
        C --> D[–í—ã–±–æ—Ä –∞–≤—Ç–æ–º–æ–±–∏–ª—è]
        D --> E[–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ]
    end
    
    subgraph "–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞"
        F[GarageManager] --> G[CarStatusManager]
        F --> H[RequestProcessor]
        F --> I[PaymentProcessor]
    end
    
    subgraph "–ú–æ–¥–µ—Ä–∞—Ü–∏—è"
        J[AdminNotifier] --> K[ModerationPanel]
        K --> L[ApprovalFlow]
        L --> M[RejectionFlow]
    end
    
    subgraph "–•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö"
        N[(garage —Ç–∞–±–ª–∏—Ü–∞)]
        O[(garage_requests —Ç–∞–±–ª–∏—Ü–∞)]
        P[(–§–æ—Ç–æ –∑–∞—è–≤–æ–∫)]
    end
    
    E --> H
    H --> J
    H --> O
    L --> I
    M --> H
    F --> N
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π

–ú–æ–¥—É–ª—å –≥–∞—Ä–∞–∂–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –ø—Ä–æ–µ–∫—Ç–∞ tgai:

```mermaid
graph LR
    subgraph "–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã"
        A[app.js] --> B[User Model]
        A --> C[AuthRequest Model]
        A --> D[MenuBuilder]
        A --> E[UserTypeDetector]
    end
    
    subgraph "–ù–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≥–∞—Ä–∞–∂–∞"
        F[GarageManager] --> G[Garage Model]
        F --> H[GarageRequest Model]
        F --> I[CarManager]
    end
    
    A --> F
    B --> G
    D --> F
    
    style F fill:#ff9999
    style G fill:#ff9999  
    style H fill:#ff9999
    style I fill:#ff9999
```

## –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ garage (–æ—Å–Ω–æ–≤–Ω—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏)

```mermaid
erDiagram
    garage {
        INTEGER car_id PK
        TEXT car_name
        TEXT status
        DATETIME last_maintenance
        DATETIME created_at
        DATETIME updated_at
    }
```

**–ü–æ–ª—è:**
- `car_id` (INTEGER, PRIMARY KEY): –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∞–≤—Ç–æ–º–æ–±–∏–ª—è (1-20)
- `car_name` (TEXT, NOT NULL): –ù–∞–∑–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Infernus")
- `status` (TEXT, NOT NULL): –°–æ—Å—Ç–æ—è–Ω–∏–µ –º–∞—Å–ª–∞ ("–°—Ä–µ–¥–Ω–µ–µ", "–•–æ—Ä–æ—à–µ–µ", "–ü–ª–æ—Ö–æ–µ")
- `last_maintenance` (DATETIME): –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
- `created_at` (DATETIME): –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏
- `updated_at` (DATETIME): –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –¢–∞–±–ª–∏—Ü–∞ garage_requests (–∑–∞—è–≤–∫–∏ –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ)

```mermaid
erDiagram
    garage_requests {
        INTEGER id PK
        INTEGER car_id FK
        INTEGER user_id FK
        TEXT telegram_id
        TEXT photo_path
        TEXT payment_status
        TEXT admin_comment
        INTEGER admin_id FK
        DATETIME submitted_at
        DATETIME processed_at
        DATETIME created_at
        DATETIME updated_at
    }
    
    garage_requests }|--|| garage : belongs_to
    garage_requests }|--|| users : belongs_to
```

**–ü–æ–ª—è:**
- `id` (INTEGER, PRIMARY KEY): –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∑–∞—è–≤–∫–∏
- `car_id` (INTEGER, FOREIGN KEY): –°—Å—ã–ª–∫–∞ –Ω–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—å
- `user_id` (INTEGER, FOREIGN KEY): –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã users
- `telegram_id` (TEXT): Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞)
- `photo_path` (TEXT): –ü—É—Ç—å –∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–º—É —Ñ–æ—Ç–æ
- `payment_status` (TEXT): –°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã ("–ù–µ –≤—ã–ø–ª–∞—á–µ–Ω–æ", "–ü—Ä–∏–Ω—è—Ç–æ", "–û—Ç–∫–ª–æ–Ω–µ–Ω–æ", "–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –æ–ø–ª–∞—Ç–∞")
- `admin_comment` (TEXT): –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏
- `admin_id` (INTEGER, FOREIGN KEY): ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, –æ–±—Ä–∞–±–æ—Ç–∞–≤—à–µ–≥–æ –∑–∞—è–≤–∫—É
- `submitted_at` (DATETIME): –í—Ä–µ–º—è –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–∫–∏
- `processed_at` (DATETIME): –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–∫–∏
- `created_at` (DATETIME): –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏
- `updated_at` (DATETIME): –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### GarageManager (–æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä)

```mermaid
classDiagram
    class GarageManager {
        +bot: TelegramBot
        +carManager: CarManager
        +requestProcessor: RequestProcessor
        +adminNotifier: AdminNotifier
        +handleGarageCommand(message) Promise~void~
        +handleCarSelection(callbackQuery) Promise~void~
        +handlePhotoUpload(message) Promise~void~
        +buildGarageMenu(page, totalCars) Object
        +getCarList(page, pageSize) Promise~Array~
    }
    
    class CarManager {
        +getAllCars() Promise~Array~
        +getCarById(carId) Promise~Object~
        +updateCarStatus(carId, status) Promise~void~
        +getCarsPaginated(page, pageSize) Promise~Object~
    }
    
    class RequestProcessor {
        +createRequest(requestData) Promise~Object~
        +processApproval(requestId, adminId) Promise~void~
        +processRejection(requestId, adminId, comment) Promise~void~
        +updatePaymentStatus(requestId, status) Promise~void~
        +validateSpamLimit(telegramId) Promise~boolean~
    }
    
    class AdminNotifier {
        +notifyNewRequest(request) Promise~void~
        +sendApprovalButtons(chatId, requestId) Promise~void~
        +handleAdminAction(callbackQuery) Promise~void~
    }
    
    GarageManager --> CarManager
    GarageManager --> RequestProcessor
    GarageManager --> AdminNotifier
```

### –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

```mermaid
classDiagram
    class Garage {
        +number car_id
        +string car_name
        +string status
        +Date last_maintenance
        +Date created_at
        +Date updated_at
        +static getAllCars() Promise~Array~
        +static findById(carId) Promise~Garage~
        +static updateStatus(carId, status) Promise~void~
        +static initializeDefaultCars() Promise~void~
        +isMaintenanceNeeded() boolean
        +getStatusEmoji() string
    }
    
    class GarageRequest {
        +number id
        +number car_id
        +number user_id
        +string telegram_id
        +string photo_path
        +string payment_status
        +string admin_comment
        +number admin_id
        +Date submitted_at
        +Date processed_at
        +static create(requestData) Promise~GarageRequest~
        +static findById(id) Promise~GarageRequest~
        +static findPendingRequests() Promise~Array~
        +static findByUserAndCar(userId, carId) Promise~GarageRequest~
        +static countRecentByUser(telegramId, hours) Promise~number~
        +approve(adminId) Promise~void~
        +reject(adminId, comment) Promise~void~
        +getFormattedStatus() string
        +getCar() Promise~Garage~
        +getUser() Promise~User~
    }
    
    Garage ||--o{ GarageRequest : "has requests"
```

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

### –ö–æ–º–∞–Ω–¥–∞ /garage

–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π:

```
üöó –ì–ê–†–ê–ñ –°–ï–ú–¨–ò | –ê–í–¢–û–ú–û–ë–ò–õ–ò (1/3)

üü¢ Infernus: –•–æ—Ä–æ—à–µ–µ
üü° Cheetah: –°—Ä–µ–¥–Ω–µ–µ  
üî¥ Banshee: –ü–ª–æ—Ö–æ–µ
üü¢ Bullet: –•–æ—Ä–æ—à–µ–µ
üü° Turismo: –°—Ä–µ–¥–Ω–µ–µ

[üöó Infernus] [üöó Cheetah]
[üöó Banshee] [üöó Bullet]
[üöó Turismo] [‚û°Ô∏è –î–∞–ª–µ–µ]
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è

```mermaid
sequenceDiagram
    participant U as –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    participant B as –ë–æ—Ç
    participant GM as GarageManager
    participant RP as RequestProcessor
    participant AN as AdminNotifier
    
    U->>B: –ù–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É –∞–≤—Ç–æ–º–æ–±–∏–ª—è
    B->>GM: handleCarSelection()
    GM->>RP: validateSpamLimit()
    
    alt –õ–∏–º–∏—Ç –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω
        GM->>U: "–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –∑–∞–º–µ–Ω—ã –º–∞—Å–ª–∞ –¥–ª—è [–ú–∞—à–∏–Ω–∞ X]"
        U->>B: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ
        B->>GM: handlePhotoUpload()
        GM->>RP: createRequest()
        RP->>AN: notifyNewRequest()
        AN->>Admin: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏
        GM->>U: "–ó–∞—è–≤–∫–∞ –ø–æ–¥–∞–Ω–∞! –û–∂–∏–¥–∞–π—Ç–µ —Ä–µ—à–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞."
    else –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç
        GM->>U: "–í—ã –ø—Ä–µ–≤—ã—Å–∏–ª–∏ –ª–∏–º–∏—Ç –∑–∞—è–≤–æ–∫ (3 –≤ —á–∞—Å)"
    end
```

### –ü–∞–Ω–µ–ª—å –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

```
üö® –ù–û–í–ê–Ø –ó–ê–Ø–í–ö–ê #12345

üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤ (@ivan_petrov)
üöó –ê–≤—Ç–æ–º–æ–±–∏–ª—å: Infernus  
üì∑ –§–æ—Ç–æ: [–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è]
‚è∞ –ü–æ–¥–∞–Ω–æ: 15:30, 25.12.2023

[‚úÖ –ü—Ä–∏–Ω—è—Ç—å] [‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å]
```

## –ê–ª–≥–æ—Ä–∏—Ç–º—ã –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### –ê–ª–≥–æ—Ä–∏—Ç–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–∫–∏

```mermaid
flowchart TD
    A[–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞] --> B{–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ —Å–ø–∞–º–∞}
    B -->|–ü—Ä–µ–≤—ã—à–µ–Ω| C[–û—Ç–∫–ª–æ–Ω–∏—Ç—å —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º]
    B -->|OK| D[–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞—è–≤–∫—É –≤ –ë–î]
    D --> E[–£–≤–µ–¥–æ–º–∏—Ç—å –∞–¥–º–∏–Ω–æ–≤]
    E --> F{–î–µ–π—Å—Ç–≤–∏–µ –∞–¥–º–∏–Ω–∞}
    F -->|–ü—Ä–∏–Ω—è—Ç—å| G[–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å '–ü—Ä–∏–Ω—è—Ç–æ']
    F -->|–û—Ç–∫–ª–æ–Ω–∏—Ç—å| H[–ó–∞–ø—Ä–æ—Å–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É]
    G --> I[–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å '–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –æ–ø–ª–∞—Ç–∞']
    I --> J[–£–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–± –æ–¥–æ–±—Ä–µ–Ω–∏–∏]
    H --> K[–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É –æ—Ç –∞–¥–º–∏–Ω–∞]
    K --> L[–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ']
    L --> M[–£–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø—Ä–∏—á–∏–Ω–æ–π]
    J --> N[–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–º–æ–±–∏–ª—è]
    M --> O[–ö–æ–Ω–µ—Ü –ø—Ä–æ—Ü–µ—Å—Å–∞]
    N --> O
```

### –ê–Ω—Ç–∏-—Å–ø–∞–º —Å–∏—Å—Ç–µ–º–∞

```javascript
// –ü—Å–µ–≤–¥–æ–∫–æ–¥ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–∞ –∑–∞—è–≤–æ–∫
async function validateSpamLimit(telegramId) {
    const HOUR_LIMIT = 3;
    const recentCount = await GarageRequest.countRecentByUser(telegramId, 1); // 1 —á–∞—Å
    return recentCount < HOUR_LIMIT;
}
```

### –°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π

```mermaid
stateDiagram-v2
    [*] --> –•–æ—Ä–æ—à–µ–µ
    –•–æ—Ä–æ—à–µ–µ --> –°—Ä–µ–¥–Ω–µ–µ : –í—Ä–µ–º—è/–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
    –°—Ä–µ–¥–Ω–µ–µ --> –ü–ª–æ—Ö–æ–µ : –í—Ä–µ–º—è/–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
    –ü–ª–æ—Ö–æ–µ --> –•–æ—Ä–æ—à–µ–µ : –ó–∞–º–µ–Ω–∞ –º–∞—Å–ª–∞ –æ–¥–æ–±—Ä–µ–Ω–∞
    –°—Ä–µ–¥–Ω–µ–µ --> –•–æ—Ä–æ—à–µ–µ : –ó–∞–º–µ–Ω–∞ –º–∞—Å–ª–∞ –æ–¥–æ–±—Ä–µ–Ω–∞
```

## API –∫–æ–º–∞–Ω–¥ –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –î–æ—Å—Ç—É–ø |
|---------|----------|--------|
| `/garage` | –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ |

### Callback Query –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

| –ü–∞—Ç—Ç–µ—Ä–Ω | –û–ø–∏—Å–∞–Ω–∏–µ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ |
|---------|----------|------------|
| `select_car_{carId}` | –í—ã–±–æ—Ä –∞–≤—Ç–æ–º–æ–±–∏–ª—è | `handleCarSelection()` |
| `garage_page_{page}` | –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ | `handlePageNavigation()` |
| `garage_approve_{requestId}` | –û–¥–æ–±—Ä–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ | `handleAdminApproval()` |
| `garage_reject_{requestId}` | –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ | `handleAdminRejection()` |

### –°–æ—Å—Ç–æ—è–Ω–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞

```javascript
const GARAGE_STATES = {
    AWAITING_PHOTO: 'garage_awaiting_photo',
    AWAITING_REJECTION_REASON: 'garage_awaiting_rejection_reason'
};
```

## –°—Ö–µ–º–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å app.js

```javascript
// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π app.js
const GarageManager = require('./components/GarageManager');
const garageManager = new GarageManager(bot, ADMIN_ID);

// –ö–æ–º–∞–Ω–¥–∞ /garage
bot.onText(/\/garage/, async (msg) => {
    await garageManager.handleGarageCommand(msg);
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ callback queries –¥–ª—è –≥–∞—Ä–∞–∂–∞
bot.on('callback_query', async (callbackQuery) => {
    const data = callbackQuery.data;
    
    if (data.startsWith('select_car_')) {
        await garageManager.handleCarSelection(callbackQuery);
    } else if (data.startsWith('garage_page_')) {
        await garageManager.handlePageNavigation(callbackQuery);
    } else if (data.startsWith('garage_approve_')) {
        await garageManager.handleAdminApproval(callbackQuery);
    } else if (data.startsWith('garage_reject_')) {
        await garageManager.handleAdminRejection(callbackQuery);
    }
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –¥–ª—è –≥–∞—Ä–∞–∂–∞
bot.on('photo', async (msg) => {
    await garageManager.handlePhotoUpload(msg);
});
```

## –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 005_create_garage_tables.js

```javascript
module.exports = {
    up: async (db) => {
        // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã garage
        await db.run(`
            CREATE TABLE IF NOT EXISTS garage (
                car_id INTEGER PRIMARY KEY,
                car_name TEXT NOT NULL,
                status TEXT NOT NULL DEFAULT '–•–æ—Ä–æ—à–µ–µ',
                last_maintenance DATETIME,
                created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
                updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
            )
        `);

        // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã garage_requests
        await db.run(`
            CREATE TABLE IF NOT EXISTS garage_requests (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                car_id INTEGER NOT NULL,
                user_id INTEGER NOT NULL,
                telegram_id TEXT NOT NULL,
                photo_path TEXT NOT NULL,
                payment_status TEXT NOT NULL DEFAULT '–ù–µ –≤—ã–ø–ª–∞—á–µ–Ω–æ',
                admin_comment TEXT,
                admin_id INTEGER,
                submitted_at DATETIME DEFAULT CURRENT_TIMESTAMP,
                processed_at DATETIME,
                created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
                updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (car_id) REFERENCES garage (car_id),
                FOREIGN KEY (user_id) REFERENCES users (id),
                FOREIGN KEY (admin_id) REFERENCES users (id)
            )
        `);

        // –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
        await db.run(`CREATE INDEX IF NOT EXISTS idx_garage_requests_user_id ON garage_requests (user_id)`);
        await db.run(`CREATE INDEX IF NOT EXISTS idx_garage_requests_car_id ON garage_requests (car_id)`);
        await db.run(`CREATE INDEX IF NOT EXISTS idx_garage_requests_telegram_id ON garage_requests (telegram_id)`);
        await db.run(`CREATE INDEX IF NOT EXISTS idx_garage_requests_status ON garage_requests (payment_status)`);
        await db.run(`CREATE INDEX IF NOT EXISTS idx_garage_requests_submitted_at ON garage_requests (submitted_at)`);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        const defaultCars = [
            { car_id: 1, car_name: 'Infernus', status: '–•–æ—Ä–æ—à–µ–µ' },
            { car_id: 2, car_name: 'Cheetah', status: '–°—Ä–µ–¥–Ω–µ–µ' },
            { car_id: 3, car_name: 'Banshee', status: '–ü–ª–æ—Ö–æ–µ' },
            { car_id: 4, car_name: 'Bullet', status: '–•–æ—Ä–æ—à–µ–µ' },
            { car_id: 5, car_name: 'Turismo', status: '–°—Ä–µ–¥–Ω–µ–µ' },
            { car_id: 6, car_name: 'ZR-350', status: '–•–æ—Ä–æ—à–µ–µ' },
            { car_id: 7, car_name: 'Elegy', status: '–°—Ä–µ–¥–Ω–µ–µ' },
            { car_id: 8, car_name: 'Jester', status: '–•–æ—Ä–æ—à–µ–µ' },
            { car_id: 9, car_name: 'Uranus', status: '–ü–ª–æ—Ö–æ–µ' },
            { car_id: 10, car_name: 'Sultan', status: '–°—Ä–µ–¥–Ω–µ–µ' },
            // ... –¥–æ 20 –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
        ];

        for (const car of defaultCars) {
            await db.run(
                'INSERT OR IGNORE INTO garage (car_id, car_name, status) VALUES (?, ?, ?)',
                [car.car_id, car.car_name, car.status]
            );
        }
    }
};
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –ê–Ω—Ç–∏-—Å–ø–∞–º –º–µ—Ä—ã
- –ú–∞–∫—Å–∏–º—É–º 3 –∑–∞—è–≤–∫–∏ –≤ —á–∞—Å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –æ–∂–∏–¥–∞—é—â–∏—Ö –∑–∞—è–≤–æ–∫
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π

### –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞
- –ö–æ–º–∞–Ω–¥–∞ `/garage` –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- –ú–æ–¥–µ—Ä–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
- –í–∞–ª–∏–¥–∞—Ü–∏—è foreign key –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- Graceful handling –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ–æ—Ç–æ
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø–µ—Ä–µ–¥ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

```javascript
// tests/garageManager.test.js
describe('GarageManager', () => {
    test('should handle garage command for authorized user', async () => {
        // –¢–µ—Å—Ç –∫–æ–º–∞–Ω–¥—ã /garage
    });
    
    test('should reject unauthorized users', async () => {
        // –¢–µ—Å—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö
    });
    
    test('should enforce spam limits', async () => {
        // –¢–µ—Å—Ç –∞–Ω—Ç–∏-—Å–ø–∞–º —Å–∏—Å—Ç–µ–º—ã
    });
    
    test('should process admin approval correctly', async () => {
        // –¢–µ—Å—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è –∑–∞—è–≤–∫–∏
    });
});

// tests/garageRequest.test.js  
describe('GarageRequest Model', () => {
    test('should create request with valid data', async () => {
        // –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏
    });
    
    test('should enforce foreign key constraints', async () => {
        // –¢–µ—Å—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ë–î
    });
});
```